<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <template id="report_department_balance">
        <div class="o_account_financial_reports_page">
            <t t-call="account_financial_report.report_buttons"/>
            <t t-call="account_financial_report_extension.report_department_balance_base"/>
        </div>
    </template>

    <template id="account_financial_report_extension.report_department_balance_qweb">
        <t t-call="web.html_container">
            <t t-foreach="docs" t-as="o">
                <t t-call="account_financial_report_extension.internal_layout">
                    <t t-call="account_financial_report_extension.report_department_balance_base"/>                
                </t>
            </t>
        </t>
    </template>

    <template id="account_financial_report_extension.report_department_balance_base">
        <!-- Saved flag fields into variables, used to define columns display -->
        <t t-set="foreign_currency" t-value="o.foreign_currency"/>
        <!-- Defines global variables used by internal layout -->
        <t t-set="title">Department Balance - <t t-raw="o.company_id.name"/> - <t t-raw="o.company_id.currency_id.name"/></t>
        <t t-set="company_name" t-value="o.company_id.name"/>
        <t t-set="res_company" t-value="o.company_id"/>
        <div class="page">
            <div class="row">
                <h4 class="mt0" t-esc="title or 'Odoo Report'" style="text-align: center;"/>
            </div>
            <!-- Display filters -->
            <t t-call="account_financial_report_extension.report_department_balance_filters"/>
            <div class="act_as_table list_table" style="margin-top: 10px;"/>

            <!-- Display account lines -->
            
            <div class="act_as_table data_table" style="width: 100%;">
                <!-- Display account header -->
                <t t-call="account_financial_report_extension.report_department_balance_lines_header"/>

                <!-- Display each lines -->
                <t t-foreach="o.department_ids" t-as="line">
                    <t t-set="type" t-value='"account_type"'/>
                    <!-- Adapt -->
                    <t t-set="style" t-value="'font-size:8px;'"/>
                    <t t-set="padding" t-value="line.level * 4"/>

                    

                    <!-- Display account lines -->
                    <t t-call="account_financial_report_extension.report_department_balance_line"/>
                    <t t-foreach="line.account_ids" t-as="account">
                        <t t-call="account_financial_report_extension.report_department_balance_account"/>
                    </t>
                    <t t-call="account_financial_report_extension.report_department_balance_footer"/>
                    <!--Adapt style -->
                </t>
            </div>
            

            <!-- Display partner lines -->
            
        </div>
    </template>
    
    <template id="account_financial_report_extension.report_department_balance_filters">
        <div class="act_as_table data_table" style="width: 100%;">
            <div class="act_as_row labels">
                <div class="act_as_cell">Date range filter</div>
                
            </div>
            <div class="act_as_row">
                <div class="act_as_cell">
                    From: <span t-field="o.date_from"/> To: <span t-field="o.date_to"/>
                </div>
            </div>
        </div>
    </template>


    <template id="account_financial_report_extension.report_department_balance_lines_header">
        <!-- Display table headers for lines -->
        <div class="act_as_thead">
            <div class="act_as_row labels">
                
                <!--## Sufix-->
                <div class="act_as_cell" style="width: 7.58%;">Group</div>
                <!--## Department-->
                <div class="act_as_cell" style="width: 8.86%;">Department</div>
                
                <div class="act_as_cell" style="width: 43.58%;">Account
                </div>
                <!--## Initial balance-->
                <div class="act_as_cell" style="width: 9.64%;">Initial
                    balance</div>
                <!--## Debit-->
                <div class="act_as_cell" style="width: 9.64%;">Debit</div>
                <!--## Credit-->
                <div class="act_as_cell" style="width: 9.64%;">Credit</div>
                <!--## Period balance-->
                <div class="act_as_cell" style="width: 9.64%;">Period balance</div>
                <!--## Ending balance-->
                <div class="act_as_cell" style="width: 9.64%;">Ending balance</div>
                <t t-if="foreign_currency">
                    <!--## currency_name-->
                    <div class="act_as_cell" style="width: 4.43%;">Cur.</div>
                    <!--## amount_currency-->
                    <div class="act_as_cell" style="width: 8.86%;">Initial blance cur.</div>
                    <div class="act_as_cell" style="width: 8.86%;">Ending blance cur.</div>
                </t>
            </div>
        </div>
    </template>


    <template id="account_financial_report_extension.report_department_balance_footer">
        <!-- # line -->
        <div class="act_as_row lines">
            <!--## Code-->
            <div class="act_as_cell amount">

            </div>
            <t t-set="account_or_partner_line" t-value="line"/>
            <div class="act_as_cell right" style="width: 8.86%;">
                <t t-if="line.department_id">
                    <t t-set="res_model" t-value="'account.department'"/>
                    <span>
                        
                       
                            <t t-att-style="style" t-raw="line.name"/>
                    </span>
                </t>
            </div>
            

            <div class="act_as_cell right" > Final Balance

            </div>
            
            <!--## Account/Partner-->
            
            <!--## Initial balance-->
            <div class="act_as_cell amount">
                    <t t-if="line.department_id">                       
                            <span>
                                <t t-att-style="style" t-raw="line.initial_balance" t-options="{'widget': 'monetary', 'display_currency': res_company.currency_id}"/>
                            </span>
                        </t>
            </div>
            <!--## Debit-->
            <div class="act_as_cell amount">
                   <t t-if="line.department_id">
                        
                        <span>
                            <t t-att-style="style" t-raw="line.debit" t-options="{'widget': 'monetary', 'display_currency': res_company.currency_id}"/>
                        </span>
                    </t>
            </div>
            <!--## Credit-->
            <div class="act_as_cell amount">
                   <t t-if="line.department_id">
                        <span>
                            <t t-att-style="style" t-raw="line.credit" t-options="{'widget': 'monetary', 'display_currency': res_company.currency_id}"/>
                        </span>
                    </t>
           </div>
            <!--## Period balance-->
            <div class="act_as_cell amount">
                    <t t-if="line.department_id">
                        <span>
                            <t t-att-style="style" t-raw="line.period_balance" t-options="{'widget': 'monetary', 'display_currency': res_company.currency_id}"/>
                        </span>
                    </t>
            </div>
            <!--## Ending balance-->
            <div class="act_as_cell amount">
                    <t t-if="line.department_id">
                        <span>
                            <t t-att-style="style" t-raw="line.final_balance" t-options="{'widget': 'monetary', 'display_currency': res_company.currency_id}"/>
                        </span>
                    </t>
            </div>
            <t t-if="foreign_currency">
                <t t-if="account_or_partner_line.currency_id">
                    <!--## currency_name-->
                    <div class="act_as_cell" style="width: 4.43%;">
                        <span t-field="account_or_partner_line.currency_id.display_name"/>
                    </div>
                    <!--## Initial balance cur.-->
                     <div class="act_as_cell amount">
                        <t t-if="type == 'account_type'">
                            <t t-if="line.account_id">                               
                                <span>
                                    <t t-att-style="style" t-raw="line.initial_balance_foreign_currency" t-options="{'widget': 'monetary', 'display_currency': line.currency_id}"/>
                                </span>
                            </t>
                            <t t-if="line.account_group_id">
                                <span>
                                    <t t-att-style="style" t-raw="line.initial_balance_foreign_currency" t-options="{'widget': 'monetary', 'display_currency': line.currency_id}"/>
                                </span>
                            </t>
                        </t>

                    </div>
                    <!--## Ending balance cur.-->
                    <div class="act_as_cell amount">
                        <t t-if="type == 'account_type'">
                            <t t-if="line.account_id">
                                <span>
                                    <t t-att-style="style" t-raw="line.final_balance_foreign_currency" t-options="{'widget': 'monetary', 'display_currency': line.currency_id}"/>
                                </span>
                            </t>
                            <t t-if="line.account_group_id">
                                <span>

                                    <t t-att-style="style" t-raw="line.final_balance_foreign_currency" t-options="{'widget': 'monetary', 'display_currency': line.currency_id}"/>
                                </span>
                            </t>
                        </t>

                    </div>
                </t>
                <t t-if="not account_or_partner_line.currency_id.id">
                    <!--## balance_currency-->
                    <div class="act_as_cell"/>
                    <div class="act_as_cell"/>
                    <div class="act_as_cell"/>
                </t>
            </t>
        </div>
    </template>

    <template id="account_financial_report_extension.report_department_balance_account">
        <!-- Display table headers for lines -->
            <div class="act_as_row lines">
                <!--## Department-->
                <div class="act_as_cell left" style="width: 8.86%;">
                    <span>
                        <t t-if="account.account_id.group_id">
                            <t t-att-style="style" t-raw="account.account_id.group_id.code_prefix"/>
                        </t>
                    </span>
                </div>
                <!--## Sufix-->
                <div class="act_as_cell left" style="width: 7.58%;">
                    <span>
                        <t t-att-style="style" t-raw="account.code"/>
                    </span>
                </div>

                

                <!--## Department-->
                <div class="act_as_cell left" style="width: 48.86%;">
                    <span>
                        <t t-att-style="style" t-raw="account.name"/>
                    </span>
                </div>
                


                <!--## Initial balance-->
                <div class="act_as_cell amount" style="width: 9.64%;">
                    <span>
                        <t t-att-style="style" t-raw="account.initial_balance" t-options="{'widget': 'monetary', 'display_currency': res_company.currency_id}"/>
                    </span>
                </div>
                <!--## Debit-->
                <div class="act_as_cell amount" style="width: 9.64%;">
                    <span>
                        <t t-att-style="style" t-raw="account.debit" t-options="{'widget': 'monetary', 'display_currency': res_company.currency_id}"/>
                    </span>
                </div>
                <!--## Credit-->
                <div class="act_as_cell amount" style="width: 9.64%;">
                    <span>
                        <t t-att-style="style" t-raw="account.debit" t-options="{'widget': 'monetary', 'display_currency': res_company.currency_id}"/>
                    </span>
                </div>
                <!--## Period balance-->
                <div class="act_as_cell amount" style="width: 9.64%;">
                    <span>
                        <t t-att-style="style" t-raw="account.period_balance" t-options="{'widget': 'monetary', 'display_currency': res_company.currency_id}"/>
                    </span>
                </div>
                <!--## Ending balance-->
                <div class="act_as_cell amount" style="width: 9.64%;" >
                    <span>
                        <t t-att-style="style" t-raw="account.final_balance" t-options="{'widget': 'monetary', 'display_currency': res_company.currency_id}"/>
                    </span>
                </div>
                <t t-if="foreign_currency">
                    <!--## currency_name-->
                    <div class="act_as_cell" style="width: 4.43%;">Cur.</div>
                    <!--## amount_currency-->
                    <div class="act_as_cell" style="width: 8.86%;">Initial blance cur.</div>
                    <div class="act_as_cell" style="width: 8.86%;">Ending blance cur.</div>
                </t>
            </div>
    </template>

    <template id="account_financial_report_extension.report_department_balance_line">
        <!-- # line -->
        <div class="act_as_row lines">
            <!--## Code-->
            <t t-set="account_or_partner_line" t-value="line"/>
            <!--## Sufix-->
            <div class="act_as_cell left">
                <t t-if="line.department_id">
                    <t t-set="res_model" t-value="'account.department'"/>
                    <span>
                        <t t-set="style" t-value="'font-size: 14px;'"/>
                        <a t-att-data-active-id="line.department_id.id"
                            t-att-data-res-model="res_model"
                            class="o_account_financial_reports_web_action"
                            t-att-style="style">
                            <t t-set="style" t-value="'font-size: 14px;'"/>
                            <t t-att-style="style" t-raw="line.code_sufix"/></a>
                    </span>
                </t>
            </div>
            <div class="act_as_cell left">
                <t t-if="line.department_id">
                
                    <t t-set="res_model" t-value="'account.department'"/>
                    <span>

                        <t t-set="style" t-value="'font-size: 14px;'"/>
                        <a t-att-data-active-id="line.department_id.id"
                            t-att-data-res-model="res_model"
                            class="o_account_financial_reports_web_action"
                            t-att-style="style">
                        
                            <t t-att-style="style" t-raw="line.name"/></a>
                    </span>
                </t>
            </div>

            
            <!--## Account/Partner-->
            <!--## Debit-->
            <div class="act_as_cell amount"></div>
            
            <!--## Initial balance-->
            <div class="act_as_cell amount">
                    
            </div>
            <!--## Debit-->
            <div class="act_as_cell amount">
                  
            </div>
            <!--## Credit-->
            <div class="act_as_cell amount">
    
           </div>
            <!--## Period balance-->
            <div class="act_as_cell amount">

            </div>
            <!--## Ending balance-->
            <div class="act_as_cell amount">

            </div>
            <t t-if="foreign_currency">
                <t t-if="account_or_partner_line.currency_id">
                    <!--## currency_name-->
                    <div class="act_as_cell" style="width: 4.43%;">
                        <span t-field="account_or_partner_line.currency_id.display_name"/>
                    </div>
                    <!--## Initial balance cur.-->
                     <div class="act_as_cell amount">
                        

                    </div>
                    <!--## Ending balance cur.-->
                    <div class="act_as_cell amount">
                        
                    </div>
                </t>
                <t t-if="not account_or_partner_line.currency_id.id">
                    <!--## balance_currency-->
                    <div class="act_as_cell"/>
                    <div class="act_as_cell"/>
                    <div class="act_as_cell"/>
                </t>
            </t>
        </div>
    </template>
    
    <template id="account_financial_report_extension.report_trial_balance_header_inhe" inherit_id="account_financial_report.report_trial_balance_lines_header">
        <xpath expr="//div[hasclass('act_as_thead')]" position="replace">
            <div class="act_as_thead" id="odoo_default_row">
                <div class="act_as_row labels">
                    <t t-if="not show_partner_details">
                        <t t-if="not by_month">
                            <!-- GRUOP CODE -->
                            <div class="act_as_cell" style="width: 8.86%;">Group Code</div>
                            <!-- GRUOP NAME -->
                            <div class="act_as_cell" style="width: 8.86%;">Group Name</div>
                        </t>
                        <!--## Code-->
                        <div class="act_as_cell" style="width: 8.86%;">Code</div>
                        <!--## Account-->
                        <div class="act_as_cell" style="width: 37.58%;">Account
                        </div>
                    </t>
                    <t t-if="show_partner_details">
                        <!--## Partner-->
                        <div class="act_as_cell" style="width: 46.44%;">Partner
                        </div>
                    </t>
                    <!--## Initial balance-->
                    <div class="act_as_cell" style="width: 9.64%;">Initial
                        balance</div>
                    <!-- ##Months -->
                    <t t-if="o.by_month">
                        <t t-foreach="o.child_ids" t-as="child">
                            <div class="act_as_cell" style="width: 9.64%;">
                                <span>
                                    <t t-esc="o._get_format_date_header(child.date_from)"/>
                                </span>
                            </div>
                        </t>
                    </t>
                    <t t-if="not o.by_month">
                        <!--## Debit-->
                        <div class="act_as_cell" style="width: 9.64%;">Debit</div>
                        <!--## Credit-->
                        <div class="act_as_cell" style="width: 9.64%;">Credit</div>
                        <!--## Period balance-->
                        <div class="act_as_cell" style="width: 9.64%;">Period balance</div>
                    </t>
                    <!--## Ending balance-->
                    <div class="act_as_cell" style="width: 9.64%;">Ending balance</div>
                    <t t-if="foreign_currency">
                        <!--## currency_name-->
                        <div class="act_as_cell" style="width: 4.43%;">Cur.</div>
                        <!--## amount_currency-->
                        <div class="act_as_cell" style="width: 8.86%;">Initial blance cur.</div>
                        <div class="act_as_cell" style="width: 8.86%;">Ending blance cur.</div>
                    </t>
                </div>
            </div>
        </xpath>
    </template>
    
    <template id="account_financial_report_extension.report_trial_balance_lines_inhe" inherit_id="account_financial_report.report_trial_balance_line">
        <xpath expr="//div[hasclass('act_as_row','lines')]" position="replace">
        <!-- # line -->
            <div class="act_as_row lines">
                <t t-if="not show_partner_details">
                    <t t-if="not by_month">
                        <!-- Group code -->
                        <div class="act_as_cell left">
                            <t t-if="line.parent_id">
                                <t t-set="res_model" t-value="'account.group'"/>
                                <span>
                                    <a t-att-data-active-id="line.parent_id.id"
                                    t-att-data-res-model="res_model"
                                    class="o_account_financial_reports_web_action"
                                    t-att-style="style">
                                        <t t-att-style="style" t-raw="line.account_group_code_prefix"/></a>
                                </span>
                            </t>
                        </div>
                        <!-- Group name -->
                        <div class="act_as_cell left">
                            <t t-if="line.parent_id">
                                <t t-set="res_model" t-value="'account.group'"/>
                                <span>
                                    <a t-att-data-active-id="line.parent_id.id"
                                    t-att-data-res-model="res_model"
                                    class="o_account_financial_reports_web_action"
                                    t-att-style="style">
                                        <t t-att-style="style" t-raw="line.account_gruop_name"/></a>
                                </span>
                            </t>
                        </div>
                    </t>
                    <!--## Code-->
                    <div class="act_as_cell left">
                        <t t-if="line.account_id">
                            <t t-set="res_model" t-value="'account.account'"/>
                            <span>
                                <a t-att-data-active-id="line.account_id.id"
                                t-att-data-res-model="res_model"
                                class="o_account_financial_reports_web_action"
                                t-att-style="style">
                                    <t t-att-style="style" t-raw="line.code"/></a>
                            </span>
                        </t>
                        <t t-if="line.account_group_id">
                            <t t-set="res_model" t-value="'account.group'"/>
                            <span>
                                <a t-att-data-active-id="line.account_group_id.id"
                                t-att-data-res-model="res_model"
                                class="o_account_financial_reports_web_action"
                                t-att-style="style">
                                    <t t-att-style="style" t-raw="line.code"/></a>
                            </span>
                        </t>
                    </div>
                </t>
                <!--## Account/Partner-->
                <div class="act_as_cell left">
                    <t t-if="type == 'account_type'">
                        <t t-set="account_or_partner_line" t-value="line"/>
                        <t t-if="line.account_id">
                            <t t-set="res_model" t-value="'account.account'"/>
                            <span>
                                <a t-att-data-active-id="line.account_id.id"
                                t-att-data-res-model="res_model"
                                class="o_account_financial_reports_web_action"
                                t-att-style="style">
                                    <t t-att-style="style" t-raw="line.name"/></a>
                            </span>
                        </t>
                        <t t-if="line.account_group_id">
                            <t t-set="res_model" t-value="'account.group'"/>
                            <span>
                                <a t-att-data-active-id="line.account_group_id.id"
                                t-att-data-res-model="res_model"
                                class="o_account_financial_reports_web_action"
                                t-att-style="style">
                                    <t t-att-style="style" t-raw="line.name"/></a>
                            </span>
                        </t>
                    </t>
                    <t t-if="type == 'partner_type'">
                        <t t-set="account_or_partner_line" t-value="line.report_account_id"/>
                        <t t-set="res_model" t-value="'res.partner'"/>
                        <span>
                            <a t-att-data-active-id="line.partner_id.id"
                                t-att-data-res-model="res_model"
                                class="o_account_financial_reports_web_action"
                                t-att-style="style">
                                <t t-att-style="style" t-raw="line.name"/></a>
                        </span>
                    </t>
                </div>
                <!--## Initial balance-->
                <div class="act_as_cell amount">
                    <t t-if="type == 'account_type'">
                        <t t-if="line.account_id">
                            <t t-set="domain"
                            t-value="[('account_id', '=', line.account_id.id),
                                        ('date', '&lt;', o.date_from)]"/>
                            <span>
                                <a t-att-data-domain="domain"
                                t-att-data-res-model="'account.move.line'"
                                class="o_account_financial_reports_web_action_monetary_multi"
                                t-att-style="style">
                                <t t-att-style="style" t-raw="line.initial_balance" t-options="{'widget': 'monetary', 'display_currency': res_company.currency_id}"/></a>
                            </span>
                        </t>
                        <t t-if="line.account_group_id">
                            <t t-set="domain"
                            t-value="[('account_id', 'in', line.compute_account_ids.ids),
                                        ('date', '&lt;', o.date_from)]"/>
                            <span>
                                <a t-att-data-domain="domain"
                                t-att-data-res-model="'account.move.line'"
                                class="o_account_financial_reports_web_action_monetary_multi"
                                t-att-style="style">
                                <t t-att-style="style" t-raw="line.initial_balance" t-options="{'widget': 'monetary', 'display_currency': res_company.currency_id}"/></a>
                            </span>
                        </t>
                    </t>
                    <t t-if="type == 'partner_type'">
                        <t t-set="domain"
                        t-value="[('account_id', '=', line.report_account_id.account_id.id),
                                    ('partner_id', '=', line.partner_id.id),
                                    ('date', '&lt;', o.date_from)]"/>
                        <span>
                            <a t-att-data-domain="domain"
                            t-att-data-res-model="'account.move.line'"
                            class="o_account_financial_reports_web_action_monetary_multi"
                            t-att-style="style">
                            <t t-att-style="style" t-raw="line.initial_balance" t-options="{'widget': 'monetary', 'display_currency': res_company.currency_id}"/></a>
                        </span>
                    </t>
                </div>
                <!--##Months -->
                <t t-if="o.by_month">
                    <t t-foreach="o.child_ids" t-as="child">
                        <div class="act_as_cell amount">
                            <t t-set="domain"
                            t-value="[('account_id', '=', line.account_id.id),
                                        ('date', '&gt;=', child.date_from),
                                        ('date', '&lt;=', child.date_to),
                                        ('debit', '&lt;&gt;', 0)]"/>
                            <span>
                                <a t-att-data-domain="domain"
                                    t-att-data-res-model="'account.move.line'"
                                    class="o_account_financial_reports_web_action_monetary_multi"
                                    t-att-style="style">
                                <t t-att-style="style" t-raw="o.write_month_line_sumas_saldos(child, line)" t-options="{'widget': 'monetary', 'display_currency': res_company.currency_id}"/></a>
                            </span>
                        </div>
                    </t>
                </t>
                <t t-if="not o.by_month">                    
                    <!--## Debit-->
                    <div class="act_as_cell amount">
                        <t t-if="type == 'account_type'">
                            <t t-if="line.account_id">
                                <t t-set="domain"
                                t-value="[('account_id', '=', line.account_id.id),
                                            ('date', '&gt;=', line.report_id.date_from),
                                            ('date', '&lt;=', line.report_id.date_to),
                                            ('debit', '&lt;&gt;', 0)]"/>
                                <span>
                                    <a t-att-data-domain="domain"
                                    t-att-data-res-model="'account.move.line'"
                                    class="o_account_financial_reports_web_action_monetary_multi"
                                    t-att-style="style">
                                    <t t-att-style="style" t-raw="line.debit" t-options="{'widget': 'monetary', 'display_currency': res_company.currency_id}"/></a>
                                </span>
                            </t>
                            <t t-if="line.account_group_id">
                                <t t-set="domain"
                                t-value="[('account_id', 'in', line.compute_account_ids.ids),
                                            ('date', '&gt;=', line.report_id.date_from),
                                            ('date', '&lt;=', line.report_id.date_to),
                                            ('debit', '&lt;&gt;', 0)]"/>
                                <span>
                                    <a t-att-data-domain="domain"
                                    t-att-data-res-model="'account.move.line'"
                                    class="o_account_financial_reports_web_action_monetary_multi"
                                    t-att-style="style">
                                    <t t-att-style="style" t-raw="line.debit" t-options="{'widget': 'monetary', 'display_currency': res_company.currency_id}"/></a>
                                </span>
                            </t>
                        </t>
                        <t t-if="type == 'partner_type'">
                            <t t-set="domain"
                            t-value="[('account_id', '=', line.report_account_id.account_id.id),
                                        ('partner_id', '=', line.partner_id.id),
                                        ('date', '&gt;=', line.report_account_id.report_id.date_from),
                                        ('date', '&lt;=', line.report_account_id.report_id.date_to),
                                        ('debit', '&lt;&gt;', 0)]"/>
                            <span>
                                <a t-att-data-domain="domain"
                                t-att-data-res-model="'account.move.line'"
                                class="o_account_financial_reports_web_action_monetary_multi"
                                t-att-style="style">
                                <t t-att-style="style" t-raw="line.debit" t-options="{'widget': 'monetary', 'display_currency': res_company.currency_id}"/></a>
                            </span>
                        </t>
                    </div>
                    <!--## Credit-->
                    <div class="act_as_cell amount">
                        <t t-if="type == 'account_type'">
                            <t t-if="line.account_id">
                                <t t-set="domain"
                                t-value="[('account_id', '=', line.account_id.id),
                                            ('date', '&gt;=', line.report_id.date_from),
                                            ('date', '&lt;=', line.report_id.date_to),
                                            ('credit', '&lt;&gt;', 0)]"/>
                                <span>
                                    <a t-att-data-domain="domain"
                                    t-att-data-res-model="'account.move.line'"
                                    class="o_account_financial_reports_web_action_monetary_multi"
                                    t-att-style="style">
                                    <t t-att-style="style" t-raw="line.credit" t-options="{'widget': 'monetary', 'display_currency': res_company.currency_id}"/></a>
                                </span>
                            </t>
                            <t t-if="line.account_group_id">
                                <t t-set="domain"
                                t-value="[('account_id', 'in', line.compute_account_ids.ids),
                                            ('date', '&gt;=', line.report_id.date_from),
                                            ('date', '&lt;=', line.report_id.date_to),
                                            ('credit', '&lt;&gt;', 0)]"/>
                                <span>
                                    <a t-att-data-domain="domain"
                                    t-att-data-res-model="'account.move.line'"
                                    class="o_account_financial_reports_web_action_monetary_multi"
                                    t-att-style="style">
                                    <t t-att-style="style" t-raw="line.credit" t-options="{'widget': 'monetary', 'display_currency': res_company.currency_id}"/></a>
                                </span>
                            </t>
                        </t>
                        <t t-if="type == 'partner_type'">
                            <t t-set="domain"
                            t-value="[('account_id', '=', line.report_account_id.account_id.id),
                                        ('partner_id', '=', line.partner_id.id),
                                        ('date', '&gt;=', line.report_account_id.report_id.date_from),
                                        ('date', '&lt;=', line.report_account_id.report_id.date_to),
                                        ('credit', '&lt;&gt;', 0)]"/>
                            <span>
                                <a t-att-data-domain="domain"
                                t-att-data-res-model="'account.move.line'"
                                class="o_account_financial_reports_web_action_monetary_multi"
                                t-att-style="style">
                                <t t-att-style="style" t-raw="line.credit" t-options="{'widget': 'monetary', 'display_currency': res_company.currency_id}"/></a>
                            </span>
                        </t>
                    </div>
                    <!--## Period balance-->
                    <div class="act_as_cell amount">
                        <t t-if="type == 'account_type'">
                            <t t-if="line.account_id">
                                <t t-set="domain"
                                t-value="[('account_id', '=', line.account_id.id),
                                            ('date', '&gt;=', line.report_id.date_from),
                                            ('date', '&lt;=', line.report_id.date_to)]"/>
                                <span>
                                    <a t-att-data-domain="domain"
                                    t-att-data-res-model="'account.move.line'"
                                    class="o_account_financial_reports_web_action_monetary_multi"
                                    t-att-style="style">
                                    <t t-att-style="style" t-raw="line.period_balance" t-options="{'widget': 'monetary', 'display_currency': res_company.currency_id}"/></a>
                                </span>
                            </t>
                            <t t-if="line.account_group_id">
                                <t t-set="domain"
                                t-value="[('account_id', 'in', line.compute_account_ids.ids),
                                            ('date', '&gt;=', line.report_id.date_from),
                                            ('date', '&lt;=', line.report_id.date_to)]"/>
                                <span>
                                    <a t-att-data-domain="domain"
                                    t-att-data-res-model="'account.move.line'"
                                    class="o_account_financial_reports_web_action_multi"
                                    t-att-style="style">
                                    <t t-att-style="style" t-raw="line.period_balance" t-options="{'widget': 'monetary', 'display_currency': res_company.currency_id}"/></a>
                                </span>
                            </t>
                        </t>
                        <t t-if="type == 'partner_type'">
                            <t t-set="domain"
                            t-value="[('account_id', '=', line.report_account_id.account_id.id),
                                        ('partner_id', '=', line.partner_id.id),
                                        ('date', '&gt;=', line.report_account_id.report_id.date_from),
                                        ('date', '&lt;=', line.report_account_id.report_id.date_to)]"/>
                            <span>
                                <a t-att-data-domain="domain"
                                t-att-data-res-model="'account.move.line'"
                                class="o_account_financial_reports_web_action_monetary_multi"
                                t-att-style="style">
                                <t t-att-style="style" t-raw="line.period_balance" t-options="{'widget': 'monetary', 'display_currency': res_company.currency_id}"/></a>
                            </span>
                        </t>
                    </div>
                </t>
                <!--## Ending balance-->
                <div class="act_as_cell amount">
                    <t t-if="type == 'account_type'">
                        <t t-if="line.account_id">
                            <t t-set="domain"
                            t-value="[('account_id', '=', line.account_id.id)]"/>
                            <span>
                                <a t-att-data-domain="domain"
                                t-att-data-res-model="'account.move.line'"
                                class="o_account_financial_reports_web_action_monetary_multi"
                                t-att-style="style">
                                <t t-att-style="style" t-raw="line.final_balance" t-options="{'widget': 'monetary', 'display_currency': res_company.currency_id}"/></a>
                            </span>
                        </t>
                        <t t-if="line.account_group_id">
                            <t t-set="domain"
                            t-value="[('account_id', 'in', line.compute_account_ids.ids)]"/>
                            <span>
                                <a t-att-data-domain="domain"
                                t-att-data-res-model="'account.move.line'"
                                class="o_account_financial_reports_web_action_monetary_multi"
                                t-att-style="style">
                                <t t-att-style="style" t-raw="line.final_balance" t-options="{'widget': 'monetary', 'display_currency': res_company.currency_id}"/></a>
                            </span>
                        </t>
                    </t>
                    <t t-if="type == 'partner_type'">
                        <t t-set="domain"
                        t-value="[('account_id', '=', line.report_account_id.account_id.id),
                                    ('partner_id', '=', line.partner_id.id)]"/>
                        <span>
                            <a t-att-data-domain="domain"
                            t-att-data-res-model="'account.move.line'"
                            class="o_account_financial_reports_web_action_monetary_multi"
                            t-att-style="style">
                            <t t-att-style="style" t-raw="line.final_balance" t-options="{'widget': 'monetary', 'display_currency': res_company.currency_id}"/></a>
                        </span>
                    </t>
                </div>
                <t t-if="foreign_currency">
                    <t t-if="account_or_partner_line.currency_id">
                        <!--## currency_name-->
                        <div class="act_as_cell" style="width: 4.43%;">
                            <span t-field="account_or_partner_line.currency_id.display_name"/>
                        </div>
                        <!--## Initial balance cur.-->
                        <div class="act_as_cell amount">
                            <t t-if="type == 'account_type'">
                                <t t-if="line.account_id">
                                    <t t-set="domain"
                                    t-value="[('account_id', '=', line.account_id.id)]"/>
                                    <span>
                                        <a t-att-data-domain="domain"
                                        t-att-data-res-model="'account.move.line'"
                                        class="o_account_financial_reports_web_action_monetary_multi"
                                        t-att-style="style">
                                        <t t-att-style="style" t-raw="line.initial_balance_foreign_currency" t-options="{'widget': 'monetary', 'display_currency': line.currency_id}"/></a>
                                    </span>
                                </t>
                                <t t-if="line.account_group_id">
                                    <t t-set="domain"
                                    t-value="[('account_id', 'in', line.compute_account_ids.ids)]"/>
                                    <span>
                                        <a t-att-data-domain="domain"
                                        t-att-data-res-model="'account.move.line'"
                                        class="o_account_financial_reports_web_action_monetary_multi"
                                        t-att-style="style">
                                        <t t-att-style="style" t-raw="line.initial_balance_foreign_currency" t-options="{'widget': 'monetary', 'display_currency': line.currency_id}"/></a>
                                    </span>
                                </t>
                            </t>
                            <t t-if="type == 'partner_type'">
                                <t t-set="domain"
                                t-value="[('account_id', '=', line.report_account_id.account_id.id),
                                            ('partner_id', '=', line.partner_id.id)]"/>
                                <span>
                                    <a t-att-data-domain="domain"
                                    t-att-data-res-model="'account.move.line'"
                                    class="o_account_financial_reports_web_action_monetary_multi"
                                    t-att-style="style">
                                    <t t-att-style="style" t-raw="line.initial_balance_foreign_currency" t-options="{'widget': 'monetary', 'display_currency': line.report_account_id.currency_id}"/></a>
                                </span>
                            </t>
                        </div>
                        <!--## Ending balance cur.-->
                        <div class="act_as_cell amount">
                            <t t-if="type == 'account_type'">
                                <t t-if="line.account_id">
                                    <t t-set="domain"
                                    t-value="[('account_id', '=', line.account_id.id)]"/>
                                    <span>
                                        <a t-att-data-domain="domain"
                                        t-att-data-res-model="'account.move.line'"
                                        class="o_account_financial_reports_web_action_monetary_multi"
                                        t-att-style="style">
                                        <t t-att-style="style" t-raw="line.final_balance_foreign_currency" t-options="{'widget': 'monetary', 'display_currency': line.currency_id}"/></a>
                                    </span>
                                </t>
                                <t t-if="line.account_group_id">
                                    <t t-set="domain"
                                    t-value="[('account_id', 'in', line.compute_account_ids.ids)]"/>
                                    <span>
                                        <a t-att-data-domain="domain"
                                        t-att-data-res-model="'account.move.line'"
                                        class="o_account_financial_reports_web_action_monetary_multi"
                                        t-att-style="style">
                                        <t t-att-style="style" t-raw="line.final_balance_foreign_currency" t-options="{'widget': 'monetary', 'display_currency': line.currency_id}"/></a>
                                    </span>
                                </t>
                            </t>
                            <t t-if="type == 'partner_type'">
                                <t t-set="domain"
                                t-value="[('account_id', '=', line.report_account_id.account_id.id),
                                            ('partner_id', '=', line.partner_id.id)]"/>
                                <span>
                                    <a t-att-data-domain="domain"
                                    t-att-data-res-model="'account.move.line'"
                                    class="o_account_financial_reports_web_action_monetary_multi"
                                    t-att-style="style">
                                    <t t-att-style="style" t-raw="line.final_balance_foreign_currency" t-options="{'widget': 'monetary', 'display_currency': line.report_account_id.currency_id}"/></a>
                                </span>
                            </t>
                        </div>
                    </t>
                    <t t-if="not account_or_partner_line.currency_id.id">
                        <!--## balance_currency-->
                        <div class="act_as_cell"/>
                        <div class="act_as_cell"/>
                        <div class="act_as_cell"/>
                    </t>
                </t>
            </div>
        </xpath>
    </template>

    <template id="report_trial_balance_by_month">
        <div class="o_account_financial_reports_page">
            <t t-call="account_financial_report.report_buttons"/>
            <t t-call="account_financial_report_extension.report_trial_balance_by_month_base"/>
        </div>
    </template>

    <template id="account_financial_report_extension.report_trial_balance_by_month_qweb">
        <t t-call="web.html_container">
            <t t-foreach="docs" t-as="o">
                <t t-call="account_financial_report.internal_layout">
                    <t t-call="account_financial_report_extension.report_trial_balance_by_month_base"/>                
                </t>
            </t>
        </t>
    </template>

    <template id="account_financial_report_extension.report_trial_balance_filters">
        <div class="act_as_table data_table" style="width: 100%;">
            <div class="act_as_row labels">
                <div class="act_as_cell">Date range filter</div>
                
            </div>
            <div class="act_as_row">
                <div class="act_as_cell">
                    From: <span t-field="o.date_from"/> To: <span t-field="o.date_to"/>
                </div>
            </div>
        </div>
    </template>

    <template id="account_financial_report_extension.report_trial_balance_accounts">
        <div class="act_as_table data_table" style="width: 100%;">
            <div class="act_as_row labels">
                <div class="act_as_cell">Account Name</div>
            </div>
            <div class="act_as_row">
                <div class="act_as_cell">
                    <span t-field="group.name"/>
                </div>
            </div>
        </div>
    </template>

    <template id="account_financial_report_extension.report_trial_balance_lines_header">
        <!-- Display table headers for lines -->
        <div class="act_as_thead">
            <div class="act_as_row labels">
                <t t-if="not show_partner_details">
                    <!--## Code-->
                    <div class="act_as_cell" style="width: 11.15%;">Code</div>
                    <!--## Account-->
                    <div class="act_as_cell" style="width: 37.58%;">Account</div>
                </t>
                <!--## Initial balance-->
                <div class="act_as_cell" style="width: 10%;">Initial
                    balance</div>
                <!-- ##Months -->
                <t t-foreach="o.child_ids" t-as="child">
                     <div class="act_as_cell" style="width: 9.64%;">
                        <span>
                            <t t-esc="o._get_format_date_header(child.date_from)"/>
                        </span>
                    </div>
                </t>
                <!--## Ending balance-->
                <div class="act_as_cell" style="width: 10%;">Ending balance</div>
            </div>
        </div>
    </template>

    <template id="account_financial_report_extension.report_trial_balance_line">
        <!-- # line -->
        <div class="act_as_row lines">
            <t t-if="not show_partner_details">
                <!--## Code-->
                <div class="act_as_cell left">
                    <span>
                        <t t-att-style="style" t-raw="line.code"/>
                    </span>
                </div>
                <!--## Name-->
                <div class="act_as_cell left">
                    <span>
                        <t t-att-style="style" t-raw="line.name"/>
                    </span>
                </div>
            </t>

            <!--## Initial balance-->
            <div class="act_as_cell amount">                     
                <span>
                    <t t-att-style="style" t-raw="line.initial_balance" t-options="{'widget': 'monetary', 'display_currency': res_company.currency_id}"/>
                </span>
            </div>
            <!--## Months -->
            <t t-foreach="o.child_ids" t-as="child">
                <div class="act_as_cell amount">
                    <span>
                        <t t-esc="o.write_month_line(child, line)" t-att-style="style" t-options="{'widget': 'monetary', 'display_currency': res_company.currency_id}"/>                                        
                    </span>
                </div>
            </t>
            <!--## Ending balance-->
            <div class="act_as_cell amount">
                <span>
                    <t t-att-style="style" t-raw="line.final_balance" t-options="{'widget': 'monetary', 'display_currency': res_company.currency_id}"/>
                </span>
            </div>
        </div>
    </template>

    <template id="account_financial_report_extension.report_trial_balance_by_month_base">
        <!-- Saved flag fields into variables, used to define columns display -->
        <t t-set="foreign_currency" t-value="o.foreign_currency"/>
        <!-- Defines global variables used by internal layout -->
        <t t-set="title">Trial Balance - <t t-raw="o.company_id.name"/> - <t t-raw="o.company_id.currency_id.name"/></t>
        <t t-set="company_name" t-value="o.company_id.name"/>
        <t t-set="res_company" t-value="o.company_id"/>
        <div class="page">
            <div class="row">
                <h4 class="mt0" t-esc="title or 'Odoo Report'" style="text-align: center;"/>
            </div>
            <!-- Display filters -->
            <t t-call="account_financial_report_extension.report_trial_balance_filters"/>
            <div class="act_as_table list_table" style="margin-top: 10px;"/>
            <!-- GROUPS -->
            <t t-foreach="o._get_group_account(o.account_ids)" t-as="group">
                <div class="act_as_table list_table" style="margin-top: 10px;"/>
                <t t-call="account_financial_report_extension.report_trial_balance_accounts"/>
                <!-- Display account lines -->
                <div class="act_as_table data_table" style="width: 100%;">
                    <!-- Display account header -->
                    <t t-call="account_financial_report_extension.report_trial_balance_lines_header"/>
                    <!-- Display each lines -->
                    <t t-foreach="o._get_accounts_details(group, o.account_ids)" t-as="line">                        
                        <t t-set="type" t-value='"account_type"'/>
                        <!-- Adapt -->
                        <t t-set="style" t-value="'font-size:8px;'"/>
                        <t t-set="padding" t-value="line.level * 4"/>
                        <!-- Display account lines -->
                        <t t-call="account_financial_report_extension.report_trial_balance_line"/>
                    </t>
                </div>
            </t>
        </div>
    </template>

</odoo>